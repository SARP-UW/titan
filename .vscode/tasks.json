{
  "version": "2.0.0",
  "tasks": [
    {
      "type": "shell",
      "label": "_rmbuild",
      "command": "rm -rf build",
      "options": { "cwd": "${workspaceFolder}" },
      "windows": {
        "command": "cmd.exe",
        "args": [ "/c", "rd /s /q build" ]
      },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "_mkbuild",
      "command": "mkdir -p build",
      "options": { "cwd": "${workspaceFolder}" },
      "windows": {
        "command": "cmd.exe",
        "args": [ "/c", "if not exist build mkdir build" ]
      },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "configure",
      "detail": "Configures titan project.",
      "command": "cmake -G Ninja -B build -S . -D CMAKE_BUILD_TYPE=DEBUG -D TITAN_DEV_TARGET=ON -D TITAN_DEV_PORT=STM32H745 -D TITAN_DEV_LIB_CONFIG=${workspaceFolder}/dev/resource/lib_config.json -D TITAN_DEV_PORT_CONFIG=${workspaceFolder}/dev/resource/port_config.json -D TITAN_TEST_TARGET=ON -D TITAN_TEST_PORT=STM32H745 -D TITAN_TEST_LIB_CONFIG=${workspaceFolder}/dev/resource/lib_config.json -D TITAN_TEST_PORT_CONFIG=${workspaceFolder}/dev/resource/port_config.json --toolchain dev/resource/toolchain.cmake --log-level=VERBOSE",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "clean_configure",
      "detail": "Cleans and configures titan project.",
      "dependsOn": [ "_rmbuild", "_mkbuild", "configure" ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "build_dev",
      "detail": "Builds dev code.",
      "command": "cmake --build build --target TITAN_DEV",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": "$gcc"
    },
    {
      "type": "shell",
      "label": "build_test",
      "detail": "Builds test code.",
      "command": "cmake --build build --target TITAN_TEST",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": "$gcc"
    },
    {
      "type": "shell",
      "label": "flash_dev",
      "detail": "Flashes dev build.",
      "command": "openocd -f ${workspaceFolder}/dev/resource/flash_config.cfg -c 'program {${workspaceFolder}/build/dev/TITAN_DEV.elf} verify reset exit'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "flash_test",
      "detail": "Flashes test build.",
      "command": "openocd -f ${workspaceFolder}/dev/resource/flash_config.cfg -c 'program {${workspaceFolder}/build/test/TITAN_TEST.elf} verify reset exit'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "cbuild_dev",
      "detail": "Cleans, configures and builds dev code.",
      "dependsOn": [ "clean_configure", "build_dev" ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "cbuild_test",
      "detail": "Cleans, configures and builds test code.",
      "dependsOn": [ "clean_configure", "build_test" ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "bflash_dev",
      "detail": "Builds and flashes dev code.",
      "dependsOn": [ "build_dev", "flash_dev" ],
      "dependsOrder": "sequence",
      "group": { "kind": "build", "isDefault": true },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "bflash_test",
      "detail": "Builds and flashes test code.",
      "dependsOn": [ "build_test", "flash_test" ],
      "dependsOrder": "sequence",
      "group": { "kind": "test", "isDefault": true },
      "problemMatcher": []
    }
  ],
}